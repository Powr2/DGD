<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Jeux Vid√©o - Groupe</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;

  /* Shadows */
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);

    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
  }
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: var(--font-family-base);
    background-color: var(--color-background);
    color: var(--color-text);
    padding: var(--space-24);
    line-height: var(--line-height-normal);
}

.container {
    max-width: 1400px;
    margin: 0 auto;
}

h1 {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--space-24);
    color: var(--color-text);
}

.stats {
    display: flex;
    gap: var(--space-24);
    margin-bottom: var(--space-24);
}

.stat-card {
    background-color: var(--color-surface);
    padding: var(--space-16) var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-sm);
}

.stat-card h3 {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-secondary);
    text-transform: uppercase;
    margin-bottom: var(--space-4);
}

.stat-card .number {
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
}

.main-content {
    display: flex;
    gap: var(--space-24);
    align-items: flex-start;
}

.table-wrapper {
    flex: 1;
    overflow-x: auto;
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-md);
}

.game-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-size-sm);
}

.game-table th {
    background-color: var(--color-primary);
    color: var(--color-btn-primary-text);
    padding: var(--space-12) var(--space-16);
    text-align: left;
    font-weight: var(--font-weight-semibold);
    position: sticky;
    top: 0;
    z-index: 10;
}

.game-table th:first-child {
    left: 0;
    z-index: 11;
    min-width: 200px;
}

.game-table td {
    padding: var(--space-12) var(--space-16);
    border-bottom: 1px solid var(--color-card-border-inner);
}

.game-table td:first-child {
    font-weight: var(--font-weight-medium);
    background-color: var(--color-bg-1);
    position: sticky;
    left: 0;
    z-index: 5;
}

.game-table tbody tr:hover {
    background-color: var(--color-secondary);
}

.game-table input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: var(--color-success);
}

.game-table td.checked {
    background-color: rgba(var(--color-teal-500-rgb), 0.1);
}

.sidebar {
    width: 300px;
    flex-shrink: 0;
}

.add-section {
    background-color: var(--color-surface);
    padding: var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-sm);
    margin-bottom: var(--space-24);
}

.add-section h2 {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-16);
    color: var(--color-text);
}

.form-group {
    margin-bottom: var(--space-16);
}

.form-group label {
    display: block;
    margin-bottom: var(--space-8);
    font-weight: var(--font-weight-medium);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
}

.form-group input {
    width: 100%;
    padding: var(--space-8) var(--space-12);
    font-size: var(--font-size-base);
    color: var(--color-text);
    background-color: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-base);
    transition: border-color var(--duration-fast) var(--ease-standard);
}

.form-group input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: var(--focus-ring);
}

.btn {
    width: 100%;
    padding: var(--space-12) var(--space-16);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-medium);
    color: var(--color-btn-primary-text);
    background-color: var(--color-primary);
    border: none;
    border-radius: var(--radius-base);
    cursor: pointer;
    transition: background-color var(--duration-normal) var(--ease-standard);
}

.btn:hover {
    background-color: var(--color-primary-hover);
}

.btn:active {
    background-color: var(--color-primary-active);
}

.btn:focus {
    outline: none;
    box-shadow: var(--focus-ring);
}

.message {
    margin-top: var(--space-12);
    padding: var(--space-8) var(--space-12);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-sm);
    display: none;
}

.message.success {
    background-color: rgba(var(--color-teal-500-rgb), 0.15);
    color: var(--color-success);
    border: 1px solid rgba(var(--color-teal-500-rgb), 0.25);
}

.message.error {
    background-color: rgba(var(--color-red-500-rgb), 0.15);
    color: var(--color-error);
    border: 1px solid rgba(var(--color-red-500-rgb), 0.25);
}

.message.show {
    display: block;
}

.action-buttons {
    display: inline-flex;
    gap: var(--space-4);
    margin-left: var(--space-8);
    opacity: 0;
    transition: opacity var(--duration-fast) var(--ease-standard);
}

.game-table th:hover .action-buttons,
.game-table td:first-child:hover .action-buttons {
    opacity: 1;
}

.icon-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--space-4);
    font-size: var(--font-size-base);
    border-radius: var(--radius-sm);
    transition: background-color var(--duration-fast) var(--ease-standard);
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.icon-btn:hover {
    background-color: var(--color-secondary);
}

.icon-btn.edit {
    color: var(--color-primary);
}

.icon-btn.delete {
    color: var(--color-error);
}

.edit-input {
    padding: var(--space-4) var(--space-8);
    font-size: var(--font-size-sm);
    color: var(--color-text);
    background-color: var(--color-background);
    border: 1px solid var(--color-primary);
    border-radius: var(--radius-sm);
    outline: none;
}

.edit-actions {
    display: inline-flex;
    gap: var(--space-4);
    margin-left: var(--space-8);
}

.edit-actions button {
    padding: var(--space-4) var(--space-8);
    font-size: var(--font-size-xs);
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-weight: var(--font-weight-medium);
    transition: all var(--duration-fast) var(--ease-standard);
}

.edit-actions .confirm-btn {
    background-color: var(--color-success);
    color: var(--color-btn-primary-text);
}

.edit-actions .confirm-btn:hover {
    opacity: 0.9;
}

.edit-actions .cancel-btn {
    background-color: var(--color-secondary);
    color: var(--color-text);
}

.edit-actions .cancel-btn:hover {
    background-color: var(--color-secondary-hover);
}

.export-import-section {
    background-color: var(--color-surface);
    padding: var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-sm);
}

.export-import-section h2 {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-16);
    color: var(--color-text);
}

.button-group {
    display: flex;
    gap: var(--space-12);
    margin-bottom: var(--space-12);
}

.btn-secondary {
    width: 100%;
    padding: var(--space-12) var(--space-16);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
    background-color: var(--color-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-base);
    cursor: pointer;
    transition: background-color var(--duration-normal) var(--ease-standard);
}

.btn-secondary:hover {
    background-color: var(--color-secondary-hover);
}

.btn-secondary:active {
    background-color: var(--color-secondary-active);
}

.file-input {
    display: none;
}

.help-text {
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
    line-height: 1.4;
}



.connection-status {
    display: flex;
    align-items: center;
    gap: var(--space-8);
    padding: var(--space-12) var(--space-16);
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    margin-bottom: var(--space-24);
    box-shadow: var(--shadow-sm);
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
}

.status-indicator.connected {
    background-color: var(--color-success);
    box-shadow: 0 0 8px var(--color-success);
    animation: pulse 2s infinite;
}

.status-indicator.disconnected {
    background-color: var(--color-error);
}

.status-indicator.syncing {
    background-color: var(--color-warning);
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.status-text {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
}

@media (max-width: 1024px) {
    .main-content {
        flex-direction: column;
    }

    .sidebar {
        width: 100%;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <h1>Gestion des Jeux Vid√©o üéÆ</h1>
        
        <!-- Firebase est d√©j√† configur√© automatiquement! -->

        <!-- Connection Status -->
        <div class="connection-status" id="connectionStatus">
            <span class="status-indicator disconnected">‚óè</span>
            <span class="status-text">Non connect√© √† Firebase</span>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <h3>Joueurs</h3>
                <div class="number" id="playerCount">7</div>
            </div>
            <div class="stat-card">
                <h3>Jeux</h3>
                <div class="number" id="gameCount">22</div>
            </div>
        </div>

        <div class="main-content">
            <div class="table-wrapper">
                <table class="game-table" id="gameTable">
                    <thead>
                        <tr id="headerRow">
                            <th>Jeux / Joueurs</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>

            <div class="sidebar">
                <div class="add-section">
                    <h2>Ajouter un Jeu</h2>
                    <div class="form-group">
                        <label for="newGame">Nom du jeu</label>
                        <input type="text" id="newGame" placeholder="Ex: Fortnite">
                    </div>
                    <button class="btn" onclick="addGame()">Ajouter ce jeu</button>
                    <div class="message" id="gameMessage"></div>
                </div>

                <div class="add-section">
                    <h2>Ajouter un Joueur</h2>
                    <div class="form-group">
                        <label for="newPlayer">Pseudo du joueur</label>
                        <input type="text" id="newPlayer" placeholder="Ex: JohnDoe">
                    </div>
                    <button class="btn" onclick="addPlayer()">Ajouter ce joueur</button>
                    <div class="message" id="playerMessage"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase variables - CONFIGURATION PR√â-CONFIGUR√âE
        let firebaseApp = null;
        let database = null;
        let isFirebaseConfigured = false;
        // Configuration Firebase cod√©e en dur - pr√™te √† l'emploi!
        let firebaseConfig = {
            apiKey: "AIzaSyBVB8dxeMlczYYgXLzyo2NDELNABKzGUtA",
            authDomain: "dgdgames-1750c.firebaseapp.com",
            databaseURL: "https://dgdgames-1750c-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "dgdgames-1750c"
        };

        // Donn√©es initiales
        let players = ['Mouki', 'Powertwo', 'Tao', 'Sordax', 'Babour', 'Teklon', 'Baylie'];
        let games = [
            'AMQ/Skribblio/Gartic/Memebuddy',
            'APEX Legends',
            'ARAM',
            'Arena',
            'Battlefield 6 Redsec',
            'CIV 6',
            'COD Zombies',
            'Crusader Kings 3',
            'First Class Trouble',
            'GTA V',
            'LOL',
            'Lethal Company',
            'Marvel Rivals',
            'Overwatch 2',
            'PokeMMO',
            'REPO',
            'Sea of Thieves',
            'Shape of Dreams',
            'Supervive',
            'The FINALS',
            'Valorant/CS2',
            'Warframe'
        ];

        // √âtat des cases coch√©es (stock√© en m√©moire)
        let checkedState = {};

        // √âtat d'√©dition
        let editingGame = null;
        let editingPlayer = null;

        // Firebase initialization flag
        let isInitializing = false;
        let hasLoadedInitialData = false;

        // Initialiser l'√©tat
        function initializeState() {
            games.forEach(game => {
                checkedState[game] = {};
                players.forEach(player => {
                    checkedState[game][player] = false;
                });
            });
        }

        // Afficher un message
        function showMessage(elementId, text, type) {
            const messageEl = document.getElementById(elementId);
            messageEl.textContent = text;
            messageEl.className = `message ${type} show`;
            setTimeout(() => {
                messageEl.classList.remove('show');
            }, 3000);
        }

        // Ajouter un jeu
        function addGame() {
            const input = document.getElementById('newGame');
            const gameName = input.value.trim();

            if (!gameName) {
                showMessage('gameMessage', 'Veuillez entrer un nom de jeu', 'error');
                return;
            }

            if (games.includes(gameName)) {
                showMessage('gameMessage', 'Ce jeu existe d√©j√†', 'error');
                return;
            }

            games.push(gameName);
            checkedState[gameName] = {};
            players.forEach(player => {
                checkedState[gameName][player] = false;
            });

            input.value = '';
            renderTable();
            updateStats();
            saveGamesToFirebase();
            saveCheckedStateToFirebase();
            showMessage('gameMessage', `${gameName} a √©t√© ajout√© !`, 'success');
        }

        // Ajouter un joueur
        function addPlayer() {
            const input = document.getElementById('newPlayer');
            const playerName = input.value.trim();

            if (!playerName) {
                showMessage('playerMessage', 'Veuillez entrer un pseudo', 'error');
                return;
            }

            if (players.includes(playerName)) {
                showMessage('playerMessage', 'Ce joueur existe d√©j√†', 'error');
                return;
            }

            players.push(playerName);
            games.forEach(game => {
                checkedState[game][playerName] = false;
            });

            input.value = '';
            renderTable();
            updateStats();
            savePlayersToFirebase();
            saveCheckedStateToFirebase();
            showMessage('playerMessage', `${playerName} a √©t√© ajout√© !`, 'success');
        }

        // G√©rer le changement de case √† cocher
        function handleCheckboxChange(game, player, checked) {
            checkedState[game][player] = checked;
            
            // Mettre √† jour visuellement la cellule
            const checkbox = document.querySelector(`input[data-game="${game}"][data-player="${player}"]`);
            if (checkbox) {
                const cell = checkbox.closest('td');
                if (checked) {
                    cell.classList.add('checked');
                } else {
                    cell.classList.remove('checked');
                }
            }
            
            // Save to Firebase
            saveCheckedStateToFirebase();
        }

        // Mettre √† jour les statistiques
        function updateStats() {
            document.getElementById('playerCount').textContent = players.length;
            document.getElementById('gameCount').textContent = games.length;
        }

        // √âditer un jeu
        function editGame(gameName, element) {
            if (editingGame || editingPlayer) return;
            editingGame = gameName;
            
            const originalText = element.textContent;
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'edit-input';
            input.value = gameName;
            
            const actions = document.createElement('span');
            actions.className = 'edit-actions';
            actions.innerHTML = `
                <button class="confirm-btn" onclick="confirmEditGame('${gameName}', this)">‚úì</button>
                <button class="cancel-btn" onclick="cancelEdit()">‚úó</button>
            `;
            
            element.textContent = '';
            element.appendChild(input);
            element.appendChild(actions);
            input.focus();
            input.select();
        }

        // Confirmer l'√©dition d'un jeu
        function confirmEditGame(oldName, button) {
            const input = button.parentElement.previousElementSibling;
            const newName = input.value.trim();
            
            if (!newName) {
                alert('Le nom ne peut pas √™tre vide');
                return;
            }
            
            if (newName !== oldName && games.includes(newName)) {
                alert('Ce nom de jeu existe d√©j√†');
                return;
            }
            
            // Mettre √† jour le nom du jeu
            const index = games.indexOf(oldName);
            if (index !== -1) {
                games[index] = newName;
                // Mettre √† jour l'√©tat des cases
                checkedState[newName] = checkedState[oldName];
                delete checkedState[oldName];
            }
            
            editingGame = null;
            saveGamesToFirebase();
            saveCheckedStateToFirebase();
            renderTable();
        }

        // √âditer un joueur
        function editPlayer(playerName, element) {
            if (editingGame || editingPlayer) return;
            editingPlayer = playerName;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'edit-input';
            input.value = playerName;
            
            const actions = document.createElement('span');
            actions.className = 'edit-actions';
            actions.innerHTML = `
                <button class="confirm-btn" onclick="confirmEditPlayer('${playerName}', this)">‚úì</button>
                <button class="cancel-btn" onclick="cancelEdit()">‚úó</button>
            `;
            
            element.textContent = '';
            element.appendChild(input);
            element.appendChild(actions);
            input.focus();
            input.select();
        }

        // Confirmer l'√©dition d'un joueur
        function confirmEditPlayer(oldName, button) {
            const input = button.parentElement.previousElementSibling;
            const newName = input.value.trim();
            
            if (!newName) {
                alert('Le nom ne peut pas √™tre vide');
                return;
            }
            
            if (newName !== oldName && players.includes(newName)) {
                alert('Ce nom de joueur existe d√©j√†');
                return;
            }
            
            // Mettre √† jour le nom du joueur
            const index = players.indexOf(oldName);
            if (index !== -1) {
                players[index] = newName;
                // Mettre √† jour l'√©tat des cases
                games.forEach(game => {
                    checkedState[game][newName] = checkedState[game][oldName];
                    delete checkedState[game][oldName];
                });
            }
            
            editingPlayer = null;
            savePlayersToFirebase();
            saveCheckedStateToFirebase();
            renderTable();
        }

        // Annuler l'√©dition
        function cancelEdit() {
            editingGame = null;
            editingPlayer = null;
            renderTable();
        }

        // Supprimer un jeu
        function deleteGame(gameName) {
            if (!confirm(`√ätes-vous s√ªr de vouloir supprimer "${gameName}" ?`)) {
                return;
            }
            
            const index = games.indexOf(gameName);
            if (index !== -1) {
                games.splice(index, 1);
                delete checkedState[gameName];
                saveGamesToFirebase();
                saveCheckedStateToFirebase();
                renderTable();
                updateStats();
            }
        }

        // Supprimer un joueur
        function deletePlayer(playerName) {
            if (!confirm(`√ätes-vous s√ªr de vouloir supprimer "${playerName}" ?`)) {
                return;
            }
            
            const index = players.indexOf(playerName);
            if (index !== -1) {
                players.splice(index, 1);
                games.forEach(game => {
                    delete checkedState[game][playerName];
                });
                savePlayersToFirebase();
                saveCheckedStateToFirebase();
                renderTable();
                updateStats();
            }
        }



        // Rendre le tableau
        function renderTable() {
            const headerRow = document.getElementById('headerRow');
            const tableBody = document.getElementById('tableBody');

            // Vider le contenu existant (sauf la premi√®re colonne)
            headerRow.innerHTML = '<th>Jeux / Joueurs</th>';
            tableBody.innerHTML = '';

            // Ajouter les en-t√™tes des joueurs
            players.forEach(player => {
                const th = document.createElement('th');
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = player;
                th.appendChild(nameSpan);
                
                const actionButtons = document.createElement('span');
                actionButtons.className = 'action-buttons';
                actionButtons.innerHTML = `
                    <button class="icon-btn edit" onclick="editPlayer('${player}', this.closest('th'))" title="√âditer">
                        ‚úèÔ∏è
                    </button>
                    <button class="icon-btn delete" onclick="deletePlayer('${player}')" title="Supprimer">
                        üóëÔ∏è
                    </button>
                `;
                th.appendChild(actionButtons);
                
                headerRow.appendChild(th);
            });

            // Ajouter les lignes de jeux
            games.forEach(game => {
                const tr = document.createElement('tr');
                
                // Premi√®re colonne : nom du jeu
                const tdGame = document.createElement('td');
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = game;
                tdGame.appendChild(nameSpan);
                
                const actionButtons = document.createElement('span');
                actionButtons.className = 'action-buttons';
                actionButtons.innerHTML = `
                    <button class="icon-btn edit" onclick="editGame('${game}', this.closest('td'))" title="√âditer">
                        ‚úèÔ∏è
                    </button>
                    <button class="icon-btn delete" onclick="deleteGame('${game}')" title="Supprimer">
                        üóëÔ∏è
                    </button>
                `;
                tdGame.appendChild(actionButtons);
                
                tr.appendChild(tdGame);

                // Colonnes des joueurs avec cases √† cocher
                players.forEach(player => {
                    const td = document.createElement('td');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.dataset.game = game;
                    checkbox.dataset.player = player;
                    checkbox.checked = checkedState[game][player];
                    checkbox.addEventListener('change', (e) => {
                        handleCheckboxChange(game, player, e.target.checked);
                    });
                    
                    if (checkedState[game][player]) {
                        td.classList.add('checked');
                    }
                    
                    td.appendChild(checkbox);
                    tr.appendChild(td);
                });

                tableBody.appendChild(tr);
            });
        }

        // G√©rer la touche Entr√©e
        document.getElementById('newGame').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addGame();
            }
        });

        document.getElementById('newPlayer').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });

        // Check Firebase configuration on load - AUTO-CONNECT
        function checkFirebaseConfig() {
            // Firebase est d√©j√† configur√©, connexion automatique!
            initializeFirebase(firebaseConfig);
        }



        // Initialize Firebase
        function initializeFirebase(config) {
            try {
                if (!firebase.apps.length) {
                    firebaseApp = firebase.initializeApp(config);
                } else {
                    firebaseApp = firebase.app();
                }

                database = firebase.database();
                isFirebaseConfigured = true;
                updateConnectionStatus(true);

                // Listen for real-time updates
                setupFirebaseListeners();

                // Load initial data or initialize
                loadDataFromFirebase();
            } catch (error) {
                console.error('Erreur Firebase:', error);
                updateConnectionStatus(false);
                alert('Erreur lors de l\'initialisation de Firebase. V√©rifiez votre configuration.');
            }
        }

        // Update connection status
        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            const indicator = statusEl.querySelector('.status-indicator');
            const text = statusEl.querySelector('.status-text');

            if (connected) {
                indicator.className = 'status-indicator connected';
                text.textContent = 'Connect√© √† Firebase ‚úì';
            } else {
                indicator.className = 'status-indicator disconnected';
                text.textContent = 'Non connect√© √† Firebase ‚úó';
            }
        }

        // Setup Firebase listeners for real-time updates
        function setupFirebaseListeners() {
            // Listen for players changes
            database.ref('players').on('value', (snapshot) => {
                if (isInitializing || !hasLoadedInitialData) return;
                const data = snapshot.val();
                if (data) {
                    players.length = 0;
                    players.push(...data);
                    renderTable();
                    updateStats();
                }
            });

            // Listen for games changes
            database.ref('games').on('value', (snapshot) => {
                if (isInitializing || !hasLoadedInitialData) return;
                const data = snapshot.val();
                if (data) {
                    games.length = 0;
                    games.push(...data);
                    renderTable();
                    updateStats();
                }
            });

            // Listen for checked state changes
            database.ref('checkedState').on('value', (snapshot) => {
                if (isInitializing || !hasLoadedInitialData) return;
                const data = snapshot.val();
                if (data) {
                    checkedState = data;
                    renderTable();
                }
            });
        }

        // Load data from Firebase
        function loadDataFromFirebase() {
            isInitializing = true;
            
            database.ref('/').once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    
                    if (data && data.players && data.games) {
                        // Load existing data from Firebase
                        players.length = 0;
                        players.push(...data.players);
                        
                        games.length = 0;
                        games.push(...data.games);
                        
                        if (data.checkedState) {
                            checkedState = data.checkedState;
                        } else {
                            initializeState();
                        }
                    } else {
                        // Initialize with default data
                        initializeState();
                        saveAllDataToFirebase();
                    }
                    
                    renderTable();
                    updateStats();
                    isInitializing = false;
                    hasLoadedInitialData = true;
                })
                .catch((error) => {
                    console.error('Erreur lors du chargement:', error);
                    initializeState();
                    renderTable();
                    updateStats();
                    isInitializing = false;
                    hasLoadedInitialData = true;
                });
        }

        // Save all data to Firebase
        function saveAllDataToFirebase() {
            if (!isFirebaseConfigured) return;
            
            database.ref('/').set({
                players: players,
                games: games,
                checkedState: checkedState
            });
        }

        // Save players to Firebase
        function savePlayersToFirebase() {
            if (!isFirebaseConfigured) return;
            database.ref('players').set(players);
        }

        // Save games to Firebase
        function saveGamesToFirebase() {
            if (!isFirebaseConfigured) return;
            database.ref('games').set(games);
        }

        // Save checked state to Firebase
        function saveCheckedStateToFirebase() {
            if (!isFirebaseConfigured) return;
            database.ref('checkedState').set(checkedState);
        }

        // Initialiser l'application
        initializeState();
        renderTable();
        updateStats();
        checkFirebaseConfig();
    </script>
</body>
</html>