<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DGDGames - Jeux &amp; Clips</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;

  /* Shadows */
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);

    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
  }
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: var(--font-family-base);
    background-color: var(--color-background);
    color: var(--color-text);
    padding: var(--space-24);
    line-height: var(--line-height-normal);
}

.container {
    max-width: 1400px;
    margin: 0 auto;
}

h1 {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--space-24);
    color: var(--color-text);
}

.stats {
    display: flex;
    gap: var(--space-24);
    margin-bottom: var(--space-24);
}

.stat-card {
    background-color: var(--color-surface);
    padding: var(--space-16) var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-sm);
}

.stat-card h3 {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-secondary);
    text-transform: uppercase;
    margin-bottom: var(--space-4);
}

.stat-card .number {
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
}

.main-content {
    display: flex;
    gap: var(--space-24);
    align-items: flex-start;
}

.table-wrapper {
    flex: 1;
    overflow-x: auto;
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-md);
}

.game-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-size-sm);
}

.game-table th {
    background-color: var(--color-primary);
    color: var(--color-btn-primary-text);
    padding: var(--space-12) var(--space-16);
    text-align: left;
    font-weight: var(--font-weight-semibold);
    position: sticky;
    top: 0;
    z-index: 10;
}

.game-table th:first-child {
    left: 0;
    z-index: 11;
    min-width: 200px;
}

.game-table td {
    padding: var(--space-12) var(--space-16);
    border-bottom: 1px solid var(--color-card-border-inner);
}

.game-table td:first-child {
    font-weight: var(--font-weight-medium);
    background-color: var(--color-bg-1);
    position: sticky;
    left: 0;
    z-index: 5;
}

.game-table tbody tr:hover {
    background-color: var(--color-secondary);
}

.game-table input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: var(--color-success);
}

.game-table td.checked {
    background-color: rgba(var(--color-teal-500-rgb), 0.1);
}

.sidebar {
    width: 300px;
    flex-shrink: 0;
}

.add-section {
    background-color: var(--color-surface);
    padding: var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-sm);
    margin-bottom: var(--space-24);
}

.add-section h2 {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-16);
    color: var(--color-text);
}

.form-group {
    margin-bottom: var(--space-16);
}

.form-group label {
    display: block;
    margin-bottom: var(--space-8);
    font-weight: var(--font-weight-medium);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
}

.form-group input {
    width: 100%;
    padding: var(--space-8) var(--space-12);
    font-size: var(--font-size-base);
    color: var(--color-text);
    background-color: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-base);
    transition: border-color var(--duration-fast) var(--ease-standard);
}

.form-group input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: var(--focus-ring);
}

.btn {
    width: 100%;
    padding: var(--space-12) var(--space-16);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-medium);
    color: var(--color-btn-primary-text);
    background-color: var(--color-primary);
    border: none;
    border-radius: var(--radius-base);
    cursor: pointer;
    transition: background-color var(--duration-normal) var(--ease-standard);
}

.btn:hover {
    background-color: var(--color-primary-hover);
}

.btn:active {
    background-color: var(--color-primary-active);
}

.btn:focus {
    outline: none;
    box-shadow: var(--focus-ring);
}

.message {
    margin-top: var(--space-12);
    padding: var(--space-8) var(--space-12);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-sm);
    display: none;
}

.message.success {
    background-color: rgba(var(--color-teal-500-rgb), 0.15);
    color: var(--color-success);
    border: 1px solid rgba(var(--color-teal-500-rgb), 0.25);
}

.message.error {
    background-color: rgba(var(--color-red-500-rgb), 0.15);
    color: var(--color-error);
    border: 1px solid rgba(var(--color-red-500-rgb), 0.25);
}

.message.show {
    display: block;
}

.action-buttons {
    display: inline-flex;
    gap: var(--space-4);
    margin-left: var(--space-8);
    opacity: 0;
    transition: opacity var(--duration-fast) var(--ease-standard);
}

.game-table th:hover .action-buttons,
.game-table td:first-child:hover .action-buttons {
    opacity: 1;
}

.icon-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--space-4);
    font-size: var(--font-size-base);
    border-radius: var(--radius-sm);
    transition: background-color var(--duration-fast) var(--ease-standard);
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.icon-btn:hover {
    background-color: var(--color-secondary);
}

.icon-btn.edit {
    color: var(--color-primary);
}

.icon-btn.delete {
    color: var(--color-error);
}

.edit-input {
    padding: var(--space-4) var(--space-8);
    font-size: var(--font-size-sm);
    color: var(--color-text);
    background-color: var(--color-background);
    border: 1px solid var(--color-primary);
    border-radius: var(--radius-sm);
    outline: none;
}

.edit-actions {
    display: inline-flex;
    gap: var(--space-4);
    margin-left: var(--space-8);
}

.edit-actions button {
    padding: var(--space-4) var(--space-8);
    font-size: var(--font-size-xs);
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-weight: var(--font-weight-medium);
    transition: all var(--duration-fast) var(--ease-standard);
}

.edit-actions .confirm-btn {
    background-color: var(--color-success);
    color: var(--color-btn-primary-text);
}

.edit-actions .confirm-btn:hover {
    opacity: 0.9;
}

.edit-actions .cancel-btn {
    background-color: var(--color-secondary);
    color: var(--color-text);
}

.edit-actions .cancel-btn:hover {
    background-color: var(--color-secondary-hover);
}

.export-import-section {
    background-color: var(--color-surface);
    padding: var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-sm);
}

.export-import-section h2 {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-16);
    color: var(--color-text);
}

.button-group {
    display: flex;
    gap: var(--space-12);
    margin-bottom: var(--space-12);
}

.btn-secondary {
    width: 100%;
    padding: var(--space-12) var(--space-16);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
    background-color: var(--color-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-base);
    cursor: pointer;
    transition: background-color var(--duration-normal) var(--ease-standard);
}

.btn-secondary:hover {
    background-color: var(--color-secondary-hover);
}

.btn-secondary:active {
    background-color: var(--color-secondary-active);
}

.file-input {
    display: none;
}

.help-text {
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
    line-height: 1.4;
}



.connection-status {
    display: flex;
    align-items: center;
    gap: var(--space-8);
    padding: var(--space-12) var(--space-16);
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    margin-bottom: var(--space-24);
    box-shadow: var(--shadow-sm);
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
}

.status-indicator.connected {
    background-color: var(--color-success);
    box-shadow: 0 0 8px var(--color-success);
    animation: pulse 2s infinite;
}

.status-indicator.disconnected {
    background-color: var(--color-error);
}

.status-indicator.syncing {
    background-color: var(--color-warning);
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.status-text {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
}

@media (max-width: 1024px) {
    .main-content {
        flex-direction: column;
    }

    .sidebar {
        width: 100%;
    }
}

/* Tab Navigation */
.tab-navigation {
    display: flex;
    gap: var(--space-8);
    margin-bottom: var(--space-24);
    border-bottom: 2px solid var(--color-card-border);
}

.tab-btn {
    padding: var(--space-12) var(--space-24);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-medium);
    background: none;
    border: none;
    color: var(--color-text-secondary);
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all var(--duration-normal) var(--ease-standard);
    margin-bottom: -2px;
}

.tab-btn:hover {
    color: var(--color-text);
    background-color: var(--color-secondary);
}

.tab-btn.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
    font-weight: var(--font-weight-semibold);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* Clips Section */
.clips-container {
    display: flex;
    gap: var(--space-24);
    flex-direction: column;
}

.clips-upload-section {
    background-color: var(--color-surface);
    padding: var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-md);
}

.clips-upload-section h2 {
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-16);
    color: var(--color-text);
}

.upload-form {
    display: grid;
    gap: var(--space-16);
    max-width: 800px;
}

.form-row {
    display: grid;
    gap: var(--space-16);
    grid-template-columns: 1fr 1fr;
}

.tutorial-box {
    background-color: var(--color-bg-1);
    padding: var(--space-16);
    border-radius: var(--radius-base);
    border: 1px solid var(--color-card-border);
    margin-top: var(--space-16);
}

.tutorial-box h3 {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-12);
    color: var(--color-text);
}

.tutorial-box ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.tutorial-box li {
    padding: var(--space-8) 0;
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    line-height: 1.6;
}

.tutorial-box li strong {
    color: var(--color-text);
    font-weight: var(--font-weight-medium);
}

select[multiple] {
    min-height: 120px;
    padding: var(--space-8);
}

select[multiple] option {
    padding: var(--space-4) var(--space-8);
    border-radius: var(--radius-sm);
    margin-bottom: var(--space-2);
}

select[multiple] option:checked {
    background-color: var(--color-primary);
    color: var(--color-btn-primary-text);
}

/* Clips Gallery */
.clips-gallery-section {
    background-color: var(--color-surface);
    padding: var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-md);
}

.gallery-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-24);
}

.gallery-header h2 {
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text);
}

.filter-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-8);
    margin-bottom: var(--space-24);
}

.tag-filter {
    padding: var(--space-6) var(--space-12);
    background-color: var(--color-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
    cursor: pointer;
    transition: all var(--duration-normal) var(--ease-standard);
    display: inline-flex;
    align-items: center;
    gap: var(--space-6);
}

.tag-filter:hover {
    background-color: var(--color-secondary-hover);
    transform: translateY(-1px);
}

.tag-filter.active {
    background-color: var(--color-primary);
    color: var(--color-btn-primary-text);
    border-color: var(--color-primary);
}

.tag-count {
    background-color: rgba(0, 0, 0, 0.15);
    padding: var(--space-2) var(--space-6);
    border-radius: var(--radius-full);
    font-size: var(--font-size-xs);
}

.clips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: var(--space-24);
}

.clip-card {
    background-color: var(--color-background);
    border: 1px solid var(--color-card-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all var(--duration-normal) var(--ease-standard);
    cursor: pointer;
}

.clip-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
    border-color: var(--color-primary);
}

.clip-thumbnail {
    width: 100%;
    height: 180px;
    background: linear-gradient(135deg, var(--color-bg-1) 0%, var(--color-bg-3) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    position: relative;
    overflow: hidden;
}

.clip-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.clip-thumbnail-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.4) 50%, transparent 100%);
    padding: var(--space-16) var(--space-12) var(--space-12);
    display: flex;
    align-items: flex-end;
    opacity: 0;
    transition: opacity var(--duration-normal) var(--ease-standard);
}

.clip-card:hover .clip-thumbnail-overlay {
    opacity: 1;
}

.clip-title-overlay {
    color: var(--color-white);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.3;
}

.clip-thumbnail::after {
    content: '‚ñ∂';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    color: var(--color-white);
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7);
    opacity: 0.85;
    transition: all var(--duration-normal) var(--ease-standard);
}

.clip-card:hover .clip-thumbnail::after {
    transform: translate(-50%, -50%) scale(1.15);
    opacity: 1;
}

.clip-card:hover .clip-thumbnail img {
    transform: scale(1.05);
    transition: transform var(--duration-normal) var(--ease-standard);
}

.clip-info {
    padding: var(--space-12) var(--space-16) var(--space-16);
}

.clip-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-6);
    margin-bottom: var(--space-12);
}

.clip-tag {
    padding: var(--space-4) var(--space-8);
    background-color: var(--color-bg-2);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
}

.clip-actions {
    display: flex;
    gap: var(--space-6);
    margin-top: var(--space-8);
    justify-content: flex-end;
}

.btn-small {
    padding: var(--space-6) var(--space-12);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    border-radius: var(--radius-base);
    border: none;
    cursor: pointer;
    transition: all var(--duration-normal) var(--ease-standard);
}



.btn-edit {
    background-color: var(--color-secondary);
    color: var(--color-text);
}

.btn-edit:hover {
    background-color: var(--color-secondary-hover);
}

.btn-delete {
    background-color: rgba(var(--color-red-500-rgb), 0.15);
    color: var(--color-error);
}

.btn-delete:hover {
    background-color: rgba(var(--color-red-500-rgb), 0.25);
}

.empty-state {
    text-align: center;
    padding: var(--space-32);
    color: var(--color-text-secondary);
}

.empty-state-icon {
    font-size: 64px;
    margin-bottom: var(--space-16);
    opacity: 0.5;
}

.empty-state-text {
    font-size: var(--font-size-lg);
    margin-bottom: var(--space-8);
}

/* Search Results Dropdown */
.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-base);
    box-shadow: var(--shadow-lg);
    max-height: 400px;
    overflow-y: auto;
    z-index: 1000;
    margin-top: var(--space-4);
}

.search-result-item {
    display: flex;
    align-items: center;
    gap: var(--space-12);
    padding: var(--space-12);
    cursor: pointer;
    transition: background-color var(--duration-fast) var(--ease-standard);
    border-bottom: 1px solid var(--color-card-border-inner);
}

.search-result-item:last-child {
    border-bottom: none;
}

.search-result-item:hover,
.search-result-item.selected {
    background-color: var(--color-secondary);
}

.search-result-image {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-sm);
    object-fit: cover;
    background: linear-gradient(135deg, var(--color-bg-1) 0%, var(--color-bg-3) 100%);
    flex-shrink: 0;
}

.search-result-info {
    flex: 1;
    min-width: 0;
}

.search-result-name {
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-base);
    color: var(--color-text);
    margin-bottom: var(--space-4);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.search-result-year {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
}

.search-loading,
.search-empty {
    padding: var(--space-16);
    text-align: center;
    color: var(--color-text-secondary);
    font-size: var(--font-size-sm);
}

/* Game Images in Table */
.game-name-with-image {
    display: flex;
    align-items: center;
    gap: var(--space-12);
}

.game-image-small {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-sm);
    object-fit: cover;
    background: linear-gradient(135deg, var(--color-bg-1) 0%, var(--color-bg-3) 100%);
    flex-shrink: 0;
}

.game-image-fallback {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-sm);
    background: linear-gradient(135deg, var(--color-bg-1) 0%, var(--color-bg-3) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
}

/* Game Images in Wheel */
.wheel-game-item-image {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-sm);
    object-fit: cover;
    background: linear-gradient(135deg, var(--color-bg-1) 0%, var(--color-bg-3) 100%);
    flex-shrink: 0;
    margin-right: var(--space-8);
}

.game-checkbox-item {
    display: flex;
    align-items: center;
}

/* Clip Tag Images */
.tag-game-image {
    width: 20px;
    height: 20px;
    border-radius: var(--radius-sm);
    object-fit: cover;
    margin-right: var(--space-6);
}

/* Login Modal */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background-color: var(--color-surface);
    padding: var(--space-32);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-lg);
    max-width: 400px;
    width: 90%;
}

.modal-content h2 {
    margin-bottom: var(--space-24);
    color: var(--color-text);
    font-size: var(--font-size-2xl);
}

.modal-actions {
    display: flex;
    gap: var(--space-12);
    margin-top: var(--space-16);
}

.modal-actions .btn {
    flex: 1;
}

/* Random Tab Styles */
.random-container {
    display: grid;
    gap: var(--space-24);
    grid-template-columns: 1fr 2fr;
    grid-template-rows: auto auto;
}

.random-selection-section {
    background-color: var(--color-surface);
    padding: var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-md);
    grid-column: 1;
    grid-row: 1;
}

.random-selection-section h2 {
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-16);
    color: var(--color-text);
}

.game-count {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--color-primary);
    margin-bottom: var(--space-16);
    padding: var(--space-12);
    background-color: var(--color-bg-1);
    border-radius: var(--radius-base);
    text-align: center;
}

.game-checkboxes {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
    margin-bottom: var(--space-24);
    max-height: 400px;
    overflow-y: auto;
    padding: var(--space-8);
}

.game-checkbox-item {
    display: flex;
    align-items: center;
    padding: var(--space-12);
    border-radius: var(--radius-base);
    border: 1px solid var(--color-border);
    background-color: var(--color-background);
    cursor: pointer;
    transition: all var(--duration-normal) var(--ease-standard);
}

.game-checkbox-item:hover {
    background-color: var(--color-secondary);
    border-color: var(--color-primary);
    transform: translateX(4px);
}

.game-checkbox-item.selected {
    background-color: var(--color-bg-1);
    border-color: var(--color-primary);
    border-width: 2px;
}

.game-checkbox-item input[type="checkbox"] {
    width: 20px;
    height: 20px;
    margin-right: var(--space-12);
    cursor: pointer;
    accent-color: var(--color-primary);
}

.game-checkbox-item label {
    cursor: pointer;
    font-weight: var(--font-weight-medium);
    font-size: var(--font-size-base);
    color: var(--color-text);
    flex: 1;
}

.btn-spin {
    width: 100%;
    padding: var(--space-16) var(--space-24);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-bold);
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-hover) 100%);
    box-shadow: 0 4px 12px rgba(var(--color-teal-500-rgb), 0.3);
}

.btn-spin:hover:not(:disabled) {
    box-shadow: 0 6px 16px rgba(var(--color-teal-500-rgb), 0.4);
    transform: translateY(-2px);
}

.btn-spin:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--color-secondary);
    box-shadow: none;
}

.wheel-section {
    background-color: var(--color-surface);
    padding: var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-md);
    grid-column: 2;
    grid-row: 1 / 3;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-24);
}

.wheel-container {
    position: relative;
    width: 500px;
    height: 500px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.wheel-pointer {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 40px;
    color: var(--color-error);
    z-index: 10;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

#wheelCanvas {
    border-radius: 50%;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2), inset 0 0 0 8px var(--color-surface);
    transition: transform 0.1s ease-out;
}

.wheel-result {
    text-align: center;
    min-height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.result-display {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    padding: var(--space-20) var(--space-32);
    background-color: var(--color-bg-1);
    border-radius: var(--radius-lg);
    border: 2px solid var(--color-primary);
    animation: resultPop 0.5s ease-out;
}

@keyframes resultPop {
    0% {
        transform: scale(0.8);
        opacity: 0;
    }
    50% {
        transform: scale(1.1);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

.history-section {
    background-color: var(--color-surface);
    padding: var(--space-24);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-md);
    grid-column: 1;
    grid-row: 2;
}

.history-section h3 {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-16);
    color: var(--color-text);
}

.spin-history {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
    max-height: 300px;
    overflow-y: auto;
}

.history-item {
    padding: var(--space-12);
    background-color: var(--color-background);
    border-radius: var(--radius-base);
    border-left: 3px solid var(--color-primary);
    font-size: var(--font-size-sm);
    color: var(--color-text);
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from {
        transform: translateX(-20px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.history-item-game {
    font-weight: var(--font-weight-semibold);
    color: var(--color-primary);
}

.history-item-time {
    color: var(--color-text-secondary);
    font-size: var(--font-size-xs);
    margin-top: var(--space-4);
}

.confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background-color: var(--color-primary);
    position: absolute;
    animation: confettiFall 3s ease-out forwards;
    pointer-events: none;
}

@keyframes confettiFall {
    to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
    }
}

@media (max-width: 1200px) {
    .random-container {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
    }
    
    .random-selection-section {
        grid-column: 1;
        grid-row: 1;
    }
    
    .wheel-section {
        grid-column: 1;
        grid-row: 2;
    }
    
    .history-section {
        grid-column: 1;
        grid-row: 3;
    }
    
    .wheel-container {
        width: 400px;
        height: 400px;
    }
    
    #wheelCanvas {
        width: 400px;
        height: 400px;
    }
}

@media (max-width: 768px) {
    .wheel-container {
        width: 300px;
        height: 300px;
    }
    
    #wheelCanvas {
        width: 300px;
        height: 300px;
    }
}

/* Video Modal Styles */
.video-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    padding: var(--space-24);
    animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.video-modal-content {
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    width: 100%;
    max-width: 1200px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        transform: translateY(30px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.video-modal-close {
    position: absolute;
    top: var(--space-12);
    right: var(--space-12);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.6);
    color: var(--color-white);
    border: none;
    font-size: 28px;
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--duration-fast) var(--ease-standard);
    line-height: 1;
}

.video-modal-close:hover {
    background-color: rgba(0, 0, 0, 0.8);
    transform: scale(1.1);
}

.video-player-container {
    width: 100%;
    aspect-ratio: 16 / 9;
    background-color: var(--color-black);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    overflow: hidden;
}

.video-modal-info {
    padding: var(--space-20) var(--space-24);
    border-top: 1px solid var(--color-card-border);
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .clips-grid {
        grid-template-columns: 1fr;
    }
    
    .tab-navigation {
        overflow-x: auto;
    }
    
    .video-modal-overlay {
        padding: var(--space-12);
    }
    
    .video-modal-content {
        max-height: 95vh;
    }
    
    .video-modal-info {
        padding: var(--space-16);
    }
}
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-24);">
            <h1 style="margin: 0;">DGDGames üéÆ</h1>
            <div id="authSection">
                <button class="btn-secondary" onclick="showLoginModal()" id="loginBtn" style="width: auto; padding: var(--space-8) var(--space-16);">Se connecter</button>
                <div id="userInfo" style="display: none; align-items: center; gap: var(--space-12);">
                    <span style="color: var(--color-text); font-weight: var(--font-weight-medium);">Connect√© en tant que <strong id="userName"></strong></span>
                    <button class="btn-secondary" onclick="logout()" style="width: auto; padding: var(--space-6) var(--space-12); font-size: var(--font-size-sm);">D√©connexion</button>
                </div>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('jeux')">Jeux</button>
            <button class="tab-btn" onclick="switchTab('clips')">Clips</button>
            <button class="tab-btn" onclick="switchTab('random')">Random</button>
        </div>
        
        <!-- Firebase est d√©j√† configur√© automatiquement! -->

        <!-- Tab Content: Jeux -->
        <div class="tab-content active" id="tab-jeux">
        
        <!-- Connection Status -->
        <div class="connection-status" id="connectionStatus">
            <span class="status-indicator disconnected">‚óè</span>
            <span class="status-text">Non connect√© √† Firebase</span>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <h3>Joueurs</h3>
                <div class="number" id="playerCount">7</div>
            </div>
            <div class="stat-card">
                <h3>Jeux</h3>
                <div class="number" id="gameCount">22</div>
            </div>
        </div>

        <div class="main-content">
            <div class="table-wrapper">
                <table class="game-table" id="gameTable">
                    <thead>
                        <tr id="headerRow">
                            <th>Jeux / Joueurs</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>

            <div class="sidebar">
                <div class="add-section">
                    <h2>Ajouter un Jeu</h2>
                    <div class="form-group" style="position: relative;">
                        <label for="newGame">Rechercher un jeu</label>
                        <input type="text" id="newGame" placeholder="Tapez pour rechercher..." autocomplete="off" oninput="searchGames(this.value)" onkeydown="handleSearchKeydown(event)">
                        <div id="searchResults" class="search-results" style="display: none;"></div>
                    </div>
                    <div class="message" id="gameMessage"></div>
                </div>

                <div class="add-section">
                    <h2>Ajouter un Joueur</h2>
                    <div class="form-group">
                        <label for="newPlayer">Pseudo du joueur</label>
                        <input type="text" id="newPlayer" placeholder="Ex: JohnDoe">
                    </div>
                    <button class="btn" onclick="addPlayer()">Ajouter ce joueur</button>
                    <div class="message" id="playerMessage"></div>
                </div>
            </div>
        </div>
        
        </div>
        <!-- End Tab Content: Jeux -->
        
        <!-- Tab Content: Clips -->
        <div class="tab-content" id="tab-clips">
            <div class="clips-container">
                <!-- Upload Section -->
                <div class="clips-upload-section">
                    <h2>üì§ Upload un Clip</h2>
                    
                    <div class="upload-form">
                        <div class="form-group">
                            <label for="clipTitle">Titre du clip</label>
                            <input type="text" id="clipTitle" class="form-control" placeholder="Ex: Mon epic pentakill" />
                        </div>
                        
                        <div class="form-group">
                            <label for="clipPseudo">Votre pseudo (optionnel)</label>
                            <input type="text" id="clipPseudo" class="form-control" placeholder="Ex: Powertwo" />
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clipUrl">Lien du clip (YouTube, Twitch, etc.)</label>
                                <input type="url" id="clipUrl" class="form-control" placeholder="https://youtube.com/watch?v=..." />
                            </div>
                            
                            <div class="form-group">
                                <label for="clipGames">Jeu(x) associ√©(s)</label>
                                <select id="clipGames" class="form-control" multiple>
                                    <!-- Options dynamically populated -->
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn" onclick="uploadClip()">Uploader le clip</button>
                        <div class="message" id="clipMessage"></div>
                    </div>
                    
                    <div class="tutorial-box">
                        <h3>üí° Comment obtenir le lien d'une vid√©o ?</h3>
                        <ul>
                            <li><strong>YouTube:</strong> Cliquez sur "Partager" sous la vid√©o, puis copiez le lien (ex: https://youtube.com/watch?v=...)</li>
                            <li><strong>Twitch:</strong> Cliquez sur "Partager" sur le clip, puis copiez le lien (ex: https://clips.twitch.tv/...)</li>
                            <li><strong>Autres sites:</strong> Copiez simplement l'URL de la page de la vid√©o depuis la barre d'adresse</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Gallery Section -->
                <div class="clips-gallery-section">
                    <div class="gallery-header">
                        <h2>üé¨ Tous les Clips</h2>
                        <span id="clipCount" style="color: var(--color-text-secondary); font-size: var(--font-size-base);">0 clips</span>
                    </div>
                    
                    <div class="filter-tags" id="filterTags">
                        <!-- Tags dynamically populated -->
                    </div>
                    
                    <div class="clips-grid" id="clipsGrid">
                        <!-- Clips dynamically populated -->
                    </div>
                </div>
            </div>
        </div>
        <!-- End Tab Content: Clips -->
        
        <!-- Tab Content: Random -->
        <div class="tab-content" id="tab-random">
            <div class="random-container">
                <!-- Game Selection Section -->
                <div class="random-selection-section">
                    <h2>üé≤ S√©lectionnez les jeux pour la roue</h2>
                    <div id="randomGameCount" class="game-count">0 jeux s√©lectionn√©s</div>
                    <div class="game-checkboxes" id="randomGameCheckboxes">
                        <!-- Dynamically populated -->
                    </div>
                    <button class="btn btn-spin" id="spinButton" onclick="spinWheel()" disabled>
                        üéØ Lancer la roue
                    </button>
                </div>
                
                <!-- Wheel Section -->
                <div class="wheel-section">
                    <div class="wheel-container">
                        <div class="wheel-pointer">‚ñº</div>
                        <canvas id="wheelCanvas" width="500" height="500"></canvas>
                    </div>
                    <div id="wheelResult" class="wheel-result"></div>
                </div>
                
                <!-- History Section -->
                <div class="history-section">
                    <h3>üìú Historique des r√©sultats</h3>
                    <div id="spinHistory" class="spin-history">
                        <div class="empty-state-text" style="color: var(--color-text-secondary); font-size: var(--font-size-sm);">Aucun r√©sultat pour le moment</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Tab Content: Random -->
        
    </div>

    <script>
        // Firebase variables - CONFIGURATION PR√â-CONFIGUR√âE
        let firebaseApp = null;
        let database = null;
        let isFirebaseConfigured = false;
        // Configuration Firebase cod√©e en dur - pr√™te √† l'emploi!
        let firebaseConfig = {
            apiKey: "AIzaSyBVB8dxeMlczYYgXLzyo2NDELNABKzGUtA",
            authDomain: "dgdgames-1750c.firebaseapp.com",
            databaseURL: "https://dgdgames-1750c-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "dgdgames-1750c"
        };

        // Current active tab
        let activeTab = 'jeux';
        
        // Random wheel variables
        let selectedGamesForWheel = [];
        let wheelCanvas = null;
        let wheelCtx = null;
        let currentRotation = 0;
        let isSpinning = false;
        let spinHistory = [];
        let wheelColors = [
            '#1FB8CD', '#FFC185', '#B4413C', '#ECEBD5', '#5D878F',
            '#DB4545', '#D2BA4C', '#964325', '#944454', '#13343B',
            '#32B8C6', '#E6815F', '#21803D', '#7C3AED', '#C2410C'
        ];
        
        // Authentication state
        let isAdmin = false;
        let currentUser = null;
        
        // Clips data
        let clips = [];
        let activeFilter = null;
        
        // Donn√©es initiales - avec tirets pour affichage
        let players = ['Mouki', 'Powertwo', 'Tao', 'Sordax', 'Babour', 'Teklon', 'Baylie'];
        let games = [
            'AMQ - Skribblio - Gartic - Memebuddy',
            'APEX Legends',
            'ARAM',
            'Arena',
            'Battlefield 6 Redsec',
            'CIV 6',
            'COD Zombies',
            'Crusader Kings 3',
            'First Class Trouble',
            'GTA V',
            'LOL',
            'Lethal Company',
            'Marvel Rivals',
            'Overwatch 2',
            'PokeMMO',
            'REPO',
            'Sea of Thieves',
            'Shape of Dreams',
            'Supervive',
            'The FINALS',
            'Valorant - CS2',
            'Warframe'
        ];
        
        // RAWG API Configuration
        const RAWG_API_BASE = 'https://api.rawg.io/api';
        const RAWG_SEARCH_ENDPOINT = '/games';
        
        // Game images cache (stored in memory)
        let gameImagesCache = {};
        
        // Search state
        let searchDebounceTimer = null;
        let currentSearchResults = [];

        // √âtat des cases coch√©es (stock√© en m√©moire)
        let checkedState = {};

        // √âtat d'√©dition
        let editingGame = null;
        let editingPlayer = null;
        let editingClip = null;
        
        // Tab switching
        function switchTab(tabName) {
            activeTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('tab-' + tabName).classList.add('active');
            
            // Load clips data if switching to clips tab
            if (tabName === 'clips') {
                populateClipGameSelect();
                renderClipsGallery();
                renderFilterTags();
            }
            
            // Load random wheel if switching to random tab
            if (tabName === 'random') {
                initializeRandomWheel();
            }
        }
        
        // Populate game select for clips
        function populateClipGameSelect() {
            const select = document.getElementById('clipGames');
            select.innerHTML = '';
            
            games.forEach(game => {
                const option = document.createElement('option');
                option.value = game;
                option.textContent = game;
                select.appendChild(option);
            });
        }
        
        // Show login modal
        function showLoginModal() {
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.innerHTML = `
                <div class="modal-content">
                    <h2>üîê Connexion Admin</h2>
                    <div class="form-group">
                        <label for="loginUsername">Login</label>
                        <input type="text" id="loginUsername" class="form-control" placeholder="Votre login" />
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Mot de passe</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Votre mot de passe" />
                    </div>
                    <div class="message" id="loginMessage"></div>
                    <div class="modal-actions">
                        <button class="btn-secondary" onclick="closeLoginModal()">Annuler</button>
                        <button class="btn" onclick="attemptLogin()">Se connecter</button>
                    </div>
                </div>
            `;
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    closeLoginModal();
                }
            };
            
            document.body.appendChild(overlay);
            document.getElementById('loginUsername').focus();
            
            // Handle Enter key
            document.getElementById('loginUsername').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('loginPassword').focus();
                }
            });
            
            document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    attemptLogin();
                }
            });
        }
        
        // Close login modal
        function closeLoginModal() {
            const overlay = document.querySelector('.modal-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // Attempt login
        function attemptLogin() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            // Check credentials
            if (username === 'Powertwo' && password === 'DGD') {
                isAdmin = true;
                currentUser = username;
                
                // Update UI
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('userName').textContent = username;
                
                closeLoginModal();
                
                // Refresh clips gallery to show admin buttons
                if (activeTab === 'clips') {
                    renderClipsGallery();
                }
            } else {
                const messageEl = document.getElementById('loginMessage');
                messageEl.textContent = 'Identifiants incorrects';
                messageEl.className = 'message error show';
                setTimeout(() => {
                    messageEl.classList.remove('show');
                }, 3000);
            }
        }
        
        // Logout
        function logout() {
            isAdmin = false;
            currentUser = null;
            
            // Update UI
            document.getElementById('loginBtn').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
            
            // Refresh clips gallery to hide admin buttons
            if (activeTab === 'clips') {
                renderClipsGallery();
            }
        }
        
        // Upload clip
        function uploadClip() {
            const title = document.getElementById('clipTitle').value.trim();
            const url = document.getElementById('clipUrl').value.trim();
            const pseudo = document.getElementById('clipPseudo').value.trim() || 'Anonyme';
            const select = document.getElementById('clipGames');
            const selectedGames = Array.from(select.selectedOptions).map(opt => opt.value);
            
            // Validation
            if (!title) {
                showMessage('clipMessage', 'Veuillez entrer un titre pour le clip', 'error');
                return;
            }
            
            if (!url) {
                showMessage('clipMessage', 'Veuillez entrer un lien pour le clip', 'error');
                return;
            }
            
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                showMessage('clipMessage', 'Le lien doit commencer par http:// ou https://', 'error');
                return;
            }
            
            if (selectedGames.length === 0) {
                showMessage('clipMessage', 'Veuillez s√©lectionner au moins un jeu', 'error');
                return;
            }
            
            // Create clip object
            const clip = {
                id: Date.now().toString(),
                titre: title,
                url: url,
                pseudo: pseudo,
                jeux: selectedGames,
                dateAjout: Date.now()
            };
            
            // Add to clips array
            clips.push(clip);
            
            // Save to Firebase
            saveClipsToFirebase();
            
            // Clear form
            document.getElementById('clipTitle').value = '';
            document.getElementById('clipUrl').value = '';
            document.getElementById('clipPseudo').value = '';
            select.selectedIndex = -1;
            
            // Show success message
            showMessage('clipMessage', `Clip "${title}" ajout√© avec succ√®s !`, 'success');
            
            // Refresh gallery
            renderClipsGallery();
            renderFilterTags();
        }
        
        // Extract video ID from URL
        function extractVideoId(url) {
            // YouTube
            const youtubeMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&?]+)/);
            if (youtubeMatch) {
                return { platform: 'youtube', id: youtubeMatch[1] };
            }
            
            // Twitch clip
            const twitchClipMatch = url.match(/clips\.twitch\.tv\/([^?]+)/);
            if (twitchClipMatch) {
                return { platform: 'twitch-clip', id: twitchClipMatch[1] };
            }
            
            // Twitch video
            const twitchVideoMatch = url.match(/twitch\.tv\/videos\/([^?]+)/);
            if (twitchVideoMatch) {
                return { platform: 'twitch-video', id: twitchVideoMatch[1] };
            }
            
            return { platform: 'other', id: null };
        }
        
        // Get video thumbnail
        function getVideoThumbnail(url) {
            const videoInfo = extractVideoId(url);
            
            if (videoInfo.platform === 'youtube') {
                // Try maxresdefault first, will fallback to hqdefault in image onerror
                return `https://img.youtube.com/vi/${videoInfo.id}/hqdefault.jpg`;
            }
            
            return null;
        }
        
        // Get platform badge
        function getPlatformBadge(url) {
            const videoInfo = extractVideoId(url);
            
            if (videoInfo.platform === 'youtube') {
                return '<span style="position: absolute; top: 8px; right: 8px; background-color: #FF0000; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">YouTube</span>';
            } else if (videoInfo.platform.startsWith('twitch')) {
                return '<span style="position: absolute; top: 8px; right: 8px; background-color: #9146FF; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">Twitch</span>';
            }
            
            return '';
        }
        
        // Render clips gallery
        function renderClipsGallery() {
            const grid = document.getElementById('clipsGrid');
            const countEl = document.getElementById('clipCount');
            
            // Filter clips
            let filteredClips = clips;
            if (activeFilter) {
                filteredClips = clips.filter(clip => clip.jeux.includes(activeFilter));
            }
            
            // Update count
            countEl.textContent = `${filteredClips.length} clip${filteredClips.length !== 1 ? 's' : ''}`;
            
            // Empty state
            if (filteredClips.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">üé¨</div>
                        <div class="empty-state-text">${activeFilter ? 'Aucun clip pour ce jeu' : 'Aucun clip pour le moment'}</div>
                        <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                            ${activeFilter ? 'Essayez un autre jeu ou uploadez le premier clip !' : 'Uploadez votre premier clip pour commencer !'}
                        </p>
                    </div>
                `;
                return;
            }
            
            // Sort by date (newest first)
            filteredClips.sort((a, b) => b.dateAjout - a.dateAjout);
            
            // Render clips
            grid.innerHTML = filteredClips.map(clip => {
                const thumbnail = getVideoThumbnail(clip.url);
                const platformBadge = getPlatformBadge(clip.url);
                const videoInfo = extractVideoId(clip.url);
                
                return `
                    <div class="clip-card" onclick="watchClip('${clip.id}')">
                        <div class="clip-thumbnail">
                            ${thumbnail ? `
                                <img src="${thumbnail}" alt="${escapeHtml(clip.titre)}" 
                                     onerror="this.style.display='none'; this.parentElement.innerHTML += '<div style=\"width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:48px;background:linear-gradient(135deg, var(--color-bg-1) 0%, var(--color-bg-3) 100%);\">üéÆ</div>';" />
                            ` : `
                                <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:48px;background:linear-gradient(135deg, var(--color-bg-1) 0%, var(--color-bg-3) 100%);">üéÆ</div>
                            `}
                            <div class="clip-thumbnail-overlay">
                                <div class="clip-title-overlay">${escapeHtml(clip.titre)}</div>
                            </div>
                            ${platformBadge}
                        </div>
                        <div class="clip-info">
                            ${clip.pseudo ? `<div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--space-8); font-weight: var(--font-weight-medium);">üë§ ${escapeHtml(clip.pseudo)}</div>` : ''}
                            <div class="clip-tags">
                                ${clip.jeux.map(jeu => `<span class="clip-tag">${escapeHtml(jeu)}</span>`).join('')}
                            </div>
                            ${isAdmin ? `
                                <div class="clip-actions" onclick="event.stopPropagation();">
                                    <button class="btn-small btn-edit" onclick="editClip('${clip.id}')">‚úèÔ∏è</button>
                                    <button class="btn-small btn-delete" onclick="deleteClip('${clip.id}')">üóëÔ∏è</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Render filter tags with images
        function renderFilterTags() {
            const container = document.getElementById('filterTags');
            
            // Get all unique games from clips
            const gameCount = {};
            clips.forEach(clip => {
                clip.jeux.forEach(jeu => {
                    gameCount[jeu] = (gameCount[jeu] || 0) + 1;
                });
            });
            
            // Sort games alphabetically
            const sortedGames = Object.keys(gameCount).sort();
            
            // Render tags
            let html = `
                <button class="tag-filter ${!activeFilter ? 'active' : ''}" onclick="filterByGame(null)">
                    Tous les clips
                    <span class="tag-count">${clips.length}</span>
                </button>
            `;
            
            sortedGames.forEach(game => {
                const imageCache = gameImagesCache[game];
                const imageHtml = imageCache && imageCache.imageUrl ? 
                    `<img src="${imageCache.imageUrl}" alt="${escapeHtml(game)}" class="tag-game-image" onerror="this.style.display='none';" />` :
                    '';
                
                html += `
                    <button class="tag-filter ${activeFilter === game ? 'active' : ''}" onclick="filterByGame('${escapeHtml(game)}')">
                        ${imageHtml}
                        ${escapeHtml(game)}
                        <span class="tag-count">${gameCount[game]}</span>
                    </button>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Filter by game
        function filterByGame(game) {
            activeFilter = game;
            renderClipsGallery();
            renderFilterTags();
        }
        
        // Watch clip - open in modal with embedded player
        function watchClip(clipId) {
            const clip = clips.find(c => c.id === clipId);
            if (!clip) return;
            
            const videoInfo = extractVideoId(clip.url);
            let embedContent = '';
            
            if (videoInfo.platform === 'youtube') {
                embedContent = `
                    <iframe 
                        width="100%" 
                        height="100%" 
                        src="https://www.youtube.com/embed/${videoInfo.id}?autoplay=1" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen
                        style="border-radius: var(--radius-lg);"
                    ></iframe>
                `;
            } else if (videoInfo.platform === 'twitch-clip') {
                embedContent = `
                    <iframe 
                        src="https://clips.twitch.tv/embed?clip=${videoInfo.id}&parent=${window.location.hostname}" 
                        height="100%" 
                        width="100%" 
                        frameborder="0" 
                        scrolling="no" 
                        allowfullscreen="true"
                        style="border-radius: var(--radius-lg);"
                    ></iframe>
                `;
            } else if (videoInfo.platform === 'twitch-video') {
                embedContent = `
                    <iframe 
                        src="https://player.twitch.tv/?video=${videoInfo.id}&parent=${window.location.hostname}&autoplay=true" 
                        height="100%" 
                        width="100%" 
                        frameborder="0" 
                        scrolling="no" 
                        allowfullscreen="true"
                        style="border-radius: var(--radius-lg);"
                    ></iframe>
                `;
            } else {
                // For other platforms, show a link
                embedContent = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; gap: var(--space-24); text-align: center; padding: var(--space-32);">
                        <div style="font-size: 64px;">üé¨</div>
                        <h3 style="font-size: var(--font-size-2xl); margin: 0;">${escapeHtml(clip.titre)}</h3>
                        <p style="color: var(--color-text-secondary);">Ce clip ne peut pas √™tre lu directement dans le navigateur.</p>
                        <a href="${clip.url}" target="_blank" class="btn" style="text-decoration: none;">Regarder sur le site original ‚Üó</a>
                    </div>
                `;
            }
            
            const overlay = document.createElement('div');
            overlay.className = 'video-modal-overlay';
            overlay.innerHTML = `
                <div class="video-modal-content">
                    <button class="video-modal-close" onclick="closeVideoModal()" aria-label="Fermer">&times;</button>
                    <div class="video-player-container">
                        ${embedContent}
                    </div>
                    <div class="video-modal-info">
                        <h3 style="margin: 0 0 var(--space-8) 0; font-size: var(--font-size-xl);">${escapeHtml(clip.titre)}</h3>
                        <div style="display: flex; align-items: center; gap: var(--space-12); flex-wrap: wrap;">
                            ${clip.pseudo ? `<span style="color: var(--color-text-secondary); font-size: var(--font-size-sm);">Par ${escapeHtml(clip.pseudo)}</span>` : ''}
                            <div style="display: flex; gap: var(--space-6); flex-wrap: wrap;">
                                ${clip.jeux.map(jeu => `<span class="clip-tag">${escapeHtml(jeu)}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    closeVideoModal();
                }
            };
            
            document.body.appendChild(overlay);
            document.body.style.overflow = 'hidden';
        }
        
        // Close video modal
        function closeVideoModal() {
            const overlay = document.querySelector('.video-modal-overlay');
            if (overlay) {
                overlay.remove();
                document.body.style.overflow = '';
            }
        }
        
        // Handle escape key to close modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeVideoModal();
            }
        });
        
        // Edit clip
        function editClip(clipId) {
            if (!isAdmin) {
                alert('Vous devez √™tre connect√© en tant qu\'admin pour modifier un clip');
                return;
            }
            
            const clip = clips.find(c => c.id === clipId);
            if (!clip) return;
            
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.innerHTML = `
                <div class="modal-content">
                    <h2>‚úèÔ∏è Modifier le Clip</h2>
                    <div class="form-group">
                        <label for="editClipTitle">Titre</label>
                        <input type="text" id="editClipTitle" class="form-control" value="${escapeHtml(clip.titre)}" />
                    </div>
                    <div class="form-group">
                        <label for="editClipGames">Jeu(x) associ√©(s)</label>
                        <select id="editClipGames" class="form-control" multiple>
                            ${games.map(game => `<option value="${escapeHtml(game)}" ${clip.jeux.includes(game) ? 'selected' : ''}>${escapeHtml(game)}</option>`).join('')}
                        </select>
                    </div>
                    <div class="modal-actions">
                        <button class="btn-secondary" onclick="closeEditModal()">Annuler</button>
                        <button class="btn" onclick="saveClipEdit('${clipId}')">Sauvegarder</button>
                    </div>
                </div>
            `;
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    closeEditModal();
                }
            };
            
            document.body.appendChild(overlay);
            document.getElementById('editClipTitle').focus();
        }
        
        // Close edit modal
        function closeEditModal() {
            const overlay = document.querySelector('.modal-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // Save clip edit
        function saveClipEdit(clipId) {
            const title = document.getElementById('editClipTitle').value.trim();
            const select = document.getElementById('editClipGames');
            const selectedGames = Array.from(select.selectedOptions).map(opt => opt.value);
            
            if (!title) {
                alert('Le titre ne peut pas √™tre vide');
                return;
            }
            
            if (selectedGames.length === 0) {
                alert('Veuillez s√©lectionner au moins un jeu');
                return;
            }
            
            const clip = clips.find(c => c.id === clipId);
            if (clip) {
                clip.titre = title;
                clip.jeux = selectedGames;
                
                saveClipsToFirebase();
                closeEditModal();
                renderClipsGallery();
                renderFilterTags();
            }
        }
        
        // Delete clip
        function deleteClip(clipId) {
            if (!isAdmin) {
                alert('Vous devez √™tre connect√© en tant qu\'admin pour supprimer un clip');
                return;
            }
            
            const clip = clips.find(c => c.id === clipId);
            if (!clip) return;
            
            if (!confirm(`√ätes-vous s√ªr de vouloir supprimer le clip "${clip.titre}" ?`)) {
                return;
            }
            
            const index = clips.findIndex(c => c.id === clipId);
            if (index !== -1) {
                clips.splice(index, 1);
                saveClipsToFirebase();
                renderClipsGallery();
                renderFilterTags();
            }
        }
        
        // HTML escape utility
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Helper functions for Firebase key conversion
        function toFirebaseKey(name) {
            // Convert display name to Firebase-safe key
            return name.replace(/\//g, '_').replace(/ - /g, '_');
        }

        function toDisplayName(key) {
            // Convert Firebase key back to display name
            // Check if it's one of the special multi-game names
            if (key === 'AMQ_Skribblio_Gartic_Memebuddy') {
                return 'AMQ - Skribblio - Gartic - Memebuddy';
            }
            if (key === 'Valorant_CS2') {
                return 'Valorant - CS2';
            }
            // For other names, just return as-is
            return key;
        }

        function sanitizeGameName(name) {
            // Convert slashes to dashes for user input
            return name.replace(/\//g, ' - ');
        }

        // Firebase initialization flag
        let isInitializing = false;
        let hasLoadedInitialData = false;

        // Initialiser l'√©tat
        function initializeState() {
            games.forEach(game => {
                const firebaseKey = toFirebaseKey(game);
                checkedState[firebaseKey] = {};
                players.forEach(player => {
                    checkedState[firebaseKey][player] = false;
                });
            });
        }

        // Afficher un message
        function showMessage(elementId, text, type) {
            const messageEl = document.getElementById(elementId);
            messageEl.textContent = text;
            messageEl.className = `message ${type} show`;
            setTimeout(() => {
                messageEl.classList.remove('show');
            }, 3000);
        }

        // Search games from RAWG API
        function searchGames(query) {
            const searchResults = document.getElementById('searchResults');
            
            // Clear previous timer
            if (searchDebounceTimer) {
                clearTimeout(searchDebounceTimer);
            }
            
            // Hide results if query is empty
            if (!query || query.trim().length < 2) {
                searchResults.style.display = 'none';
                currentSearchResults = [];
                return;
            }
            
            // Show loading
            searchResults.style.display = 'block';
            searchResults.innerHTML = '<div class="search-loading">üîç Recherche en cours...</div>';
            
            // Debounce the search
            searchDebounceTimer = setTimeout(() => {
                performGameSearch(query.trim());
            }, 300);
        }
        
        async function performGameSearch(query) {
            const searchResults = document.getElementById('searchResults');
            
            try {
                const response = await fetch(`${RAWG_API_BASE}${RAWG_SEARCH_ENDPOINT}?search=${encodeURIComponent(query)}&page_size=10`);
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const data = await response.json();
                currentSearchResults = data.results || [];
                
                if (currentSearchResults.length === 0) {
                    searchResults.innerHTML = '<div class="search-empty">‚ùå Aucun jeu trouv√©</div>';
                    return;
                }
                
                // Render results
                searchResults.innerHTML = currentSearchResults.map((game, index) => {
                    const year = game.released ? new Date(game.released).getFullYear() : '';
                    const imageUrl = game.background_image || '';
                    
                    return `
                        <div class="search-result-item" data-index="${index}" onclick="selectSearchResult(${index})">
                            ${imageUrl ? 
                                `<img src="${imageUrl}" alt="${escapeHtml(game.name)}" class="search-result-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />` :
                                ''}
                            <div class="search-result-image" style="${imageUrl ? 'display:none;' : ''}">üéÆ</div>
                            <div class="search-result-info">
                                <div class="search-result-name">${escapeHtml(game.name)}</div>
                                ${year ? `<div class="search-result-year">${year}</div>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error searching games:', error);
                searchResults.innerHTML = '<div class="search-empty">‚ö†Ô∏è Erreur lors de la recherche</div>';
            }
        }
        
        function selectSearchResult(index) {
            if (index < 0 || index >= currentSearchResults.length) return;
            
            const game = currentSearchResults[index];
            const gameName = sanitizeGameName(game.name);
            
            // Check if game already exists
            if (games.includes(gameName)) {
                showMessage('gameMessage', 'Ce jeu existe d√©j√†', 'error');
                return;
            }
            
            // Cache the image
            if (game.background_image) {
                gameImagesCache[gameName] = {
                    imageUrl: game.background_image,
                    rawgId: game.id,
                    name: game.name
                };
                saveGameImagesCacheToFirebase();
            }
            
            // Add the game
            games.push(gameName);
            const firebaseKey = toFirebaseKey(gameName);
            checkedState[firebaseKey] = {};
            players.forEach(player => {
                checkedState[firebaseKey][player] = false;
            });
            
            // Clear search
            document.getElementById('newGame').value = '';
            document.getElementById('searchResults').style.display = 'none';
            currentSearchResults = [];
            
            renderTable();
            updateStats();
            saveGamesToFirebase();
            saveCheckedStateToFirebase();
            showMessage('gameMessage', `${gameName} a √©t√© ajout√© avec son image !`, 'success');
        }
        
        function handleSearchKeydown(event) {
            const searchResults = document.getElementById('searchResults');
            if (searchResults.style.display === 'none') return;
            
            const items = searchResults.querySelectorAll('.search-result-item');
            if (items.length === 0) return;
            
            let selectedIndex = -1;
            items.forEach((item, index) => {
                if (item.classList.contains('selected')) {
                    selectedIndex = index;
                }
            });
            
            if (event.key === 'ArrowDown') {
                event.preventDefault();
                items.forEach(item => item.classList.remove('selected'));
                selectedIndex = (selectedIndex + 1) % items.length;
                items[selectedIndex].classList.add('selected');
                items[selectedIndex].scrollIntoView({ block: 'nearest' });
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                items.forEach(item => item.classList.remove('selected'));
                selectedIndex = selectedIndex <= 0 ? items.length - 1 : selectedIndex - 1;
                items[selectedIndex].classList.add('selected');
                items[selectedIndex].scrollIntoView({ block: 'nearest' });
            } else if (event.key === 'Enter') {
                event.preventDefault();
                if (selectedIndex >= 0) {
                    selectSearchResult(selectedIndex);
                } else if (items.length > 0) {
                    selectSearchResult(0);
                }
            } else if (event.key === 'Escape') {
                searchResults.style.display = 'none';
                currentSearchResults = [];
            }
        }
        
        // Close search results when clicking outside
        document.addEventListener('click', (e) => {
            const searchResults = document.getElementById('searchResults');
            const searchInput = document.getElementById('newGame');
            
            if (searchResults && !searchResults.contains(e.target) && e.target !== searchInput) {
                searchResults.style.display = 'none';
            }
        });
        
        // Fetch game image from RAWG API
        async function fetchGameImage(gameName) {
            // Check cache first
            if (gameImagesCache[gameName]) {
                return gameImagesCache[gameName].imageUrl;
            }
            
            try {
                const response = await fetch(`${RAWG_API_BASE}${RAWG_SEARCH_ENDPOINT}?search=${encodeURIComponent(gameName)}&page_size=1`);
                
                if (!response.ok) {
                    return null;
                }
                
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const game = data.results[0];
                    const imageUrl = game.background_image;
                    
                    // Cache the result
                    gameImagesCache[gameName] = {
                        imageUrl: imageUrl,
                        rawgId: game.id,
                        name: game.name
                    };
                    saveGameImagesCacheToFirebase();
                    
                    return imageUrl;
                }
            } catch (error) {
                console.error('Error fetching game image:', error);
            }
            
            return null;
        }
        
        // Load all game images
        async function loadAllGameImages() {
            const promises = games.map(game => fetchGameImage(game));
            await Promise.all(promises);
            renderTable();
            if (activeTab === 'random') {
                initializeRandomWheel();
            }
        }
        
        // Ajouter un jeu (legacy function, now replaced by search)
        function addGame() {
            const input = document.getElementById('newGame');
            let gameName = input.value.trim();

            if (!gameName) {
                showMessage('gameMessage', 'Veuillez entrer un nom de jeu', 'error');
                return;
            }

            // Sanitize the game name (convert / to -)
            gameName = sanitizeGameName(gameName);

            if (games.includes(gameName)) {
                showMessage('gameMessage', 'Ce jeu existe d√©j√†', 'error');
                return;
            }

            games.push(gameName);
            const firebaseKey = toFirebaseKey(gameName);
            checkedState[firebaseKey] = {};
            players.forEach(player => {
                checkedState[firebaseKey][player] = false;
            });

            input.value = '';
            renderTable();
            updateStats();
            saveGamesToFirebase();
            saveCheckedStateToFirebase();
            showMessage('gameMessage', `${gameName} a √©t√© ajout√© !`, 'success');
            
            // Fetch image for the new game
            fetchGameImage(gameName).then(() => {
                renderTable();
            });
        }

        // Ajouter un joueur
        function addPlayer() {
            const input = document.getElementById('newPlayer');
            const playerName = input.value.trim();

            if (!playerName) {
                showMessage('playerMessage', 'Veuillez entrer un pseudo', 'error');
                return;
            }

            if (players.includes(playerName)) {
                showMessage('playerMessage', 'Ce joueur existe d√©j√†', 'error');
                return;
            }

            players.push(playerName);
            games.forEach(game => {
                const firebaseKey = toFirebaseKey(game);
                checkedState[firebaseKey][playerName] = false;
            });

            input.value = '';
            renderTable();
            updateStats();
            savePlayersToFirebase();
            saveCheckedStateToFirebase();
            showMessage('playerMessage', `${playerName} a √©t√© ajout√© !`, 'success');
        }

        // G√©rer le changement de case √† cocher
        function handleCheckboxChange(game, player, checked) {
            const firebaseKey = toFirebaseKey(game);
            if (!checkedState[firebaseKey]) {
                checkedState[firebaseKey] = {};
            }
            checkedState[firebaseKey][player] = checked;
            
            // Mettre √† jour visuellement la cellule
            const checkbox = document.querySelector(`input[data-game="${game}"][data-player="${player}"]`);
            if (checkbox) {
                const cell = checkbox.closest('td');
                if (checked) {
                    cell.classList.add('checked');
                } else {
                    cell.classList.remove('checked');
                }
            }
            
            // Save to Firebase
            saveCheckedStateToFirebase();
        }

        // Mettre √† jour les statistiques
        function updateStats() {
            document.getElementById('playerCount').textContent = players.length;
            document.getElementById('gameCount').textContent = games.length;
        }

        // √âditer un jeu
        function editGame(gameName, element) {
            if (editingGame || editingPlayer) return;
            editingGame = gameName;
            
            const originalText = element.textContent;
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'edit-input';
            input.value = gameName;
            
            const actions = document.createElement('span');
            actions.className = 'edit-actions';
            actions.innerHTML = `
                <button class="confirm-btn" onclick="confirmEditGame('${gameName}', this)">‚úì</button>
                <button class="cancel-btn" onclick="cancelEdit()">‚úó</button>
            `;
            
            element.textContent = '';
            element.appendChild(input);
            element.appendChild(actions);
            input.focus();
            input.select();
        }

        // Confirmer l'√©dition d'un jeu
        function confirmEditGame(oldName, button) {
            const input = button.parentElement.previousElementSibling;
            let newName = input.value.trim();
            
            if (!newName) {
                alert('Le nom ne peut pas √™tre vide');
                return;
            }
            
            // Sanitize the new name
            newName = sanitizeGameName(newName);
            
            if (newName !== oldName && games.includes(newName)) {
                alert('Ce nom de jeu existe d√©j√†');
                return;
            }
            
            // Mettre √† jour le nom du jeu
            const index = games.indexOf(oldName);
            if (index !== -1) {
                games[index] = newName;
                // Mettre √† jour l'√©tat des cases avec les cl√©s Firebase
                const oldKey = toFirebaseKey(oldName);
                const newKey = toFirebaseKey(newName);
                checkedState[newKey] = checkedState[oldKey];
                delete checkedState[oldKey];
            }
            
            editingGame = null;
            saveGamesToFirebase();
            saveCheckedStateToFirebase();
            renderTable();
        }

        // √âditer un joueur
        function editPlayer(playerName, element) {
            if (editingGame || editingPlayer) return;
            editingPlayer = playerName;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'edit-input';
            input.value = playerName;
            
            const actions = document.createElement('span');
            actions.className = 'edit-actions';
            actions.innerHTML = `
                <button class="confirm-btn" onclick="confirmEditPlayer('${playerName}', this)">‚úì</button>
                <button class="cancel-btn" onclick="cancelEdit()">‚úó</button>
            `;
            
            element.textContent = '';
            element.appendChild(input);
            element.appendChild(actions);
            input.focus();
            input.select();
        }

        // Confirmer l'√©dition d'un joueur
        function confirmEditPlayer(oldName, button) {
            const input = button.parentElement.previousElementSibling;
            const newName = input.value.trim();
            
            if (!newName) {
                alert('Le nom ne peut pas √™tre vide');
                return;
            }
            
            if (newName !== oldName && players.includes(newName)) {
                alert('Ce nom de joueur existe d√©j√†');
                return;
            }
            
            // Mettre √† jour le nom du joueur
            const index = players.indexOf(oldName);
            if (index !== -1) {
                players[index] = newName;
                // Mettre √† jour l'√©tat des cases avec les cl√©s Firebase
                games.forEach(game => {
                    const firebaseKey = toFirebaseKey(game);
                    if (checkedState[firebaseKey]) {
                        checkedState[firebaseKey][newName] = checkedState[firebaseKey][oldName];
                        delete checkedState[firebaseKey][oldName];
                    }
                });
            }
            
            editingPlayer = null;
            savePlayersToFirebase();
            saveCheckedStateToFirebase();
            renderTable();
        }

        // Annuler l'√©dition
        function cancelEdit() {
            editingGame = null;
            editingPlayer = null;
            renderTable();
        }

        // Supprimer un jeu
        function deleteGame(gameName) {
            if (!confirm(`√ätes-vous s√ªr de vouloir supprimer "${gameName}" ?`)) {
                return;
            }
            
            const index = games.indexOf(gameName);
            if (index !== -1) {
                games.splice(index, 1);
                const firebaseKey = toFirebaseKey(gameName);
                delete checkedState[firebaseKey];
                saveGamesToFirebase();
                saveCheckedStateToFirebase();
                renderTable();
                updateStats();
            }
        }

        // Supprimer un joueur
        function deletePlayer(playerName) {
            if (!confirm(`√ätes-vous s√ªr de vouloir supprimer "${playerName}" ?`)) {
                return;
            }
            
            const index = players.indexOf(playerName);
            if (index !== -1) {
                players.splice(index, 1);
                games.forEach(game => {
                    const firebaseKey = toFirebaseKey(game);
                    if (checkedState[firebaseKey]) {
                        delete checkedState[firebaseKey][playerName];
                    }
                });
                savePlayersToFirebase();
                saveCheckedStateToFirebase();
                renderTable();
                updateStats();
            }
        }



        // Rendre le tableau
        function renderTable() {
            const headerRow = document.getElementById('headerRow');
            const tableBody = document.getElementById('tableBody');

            // Vider le contenu existant (sauf la premi√®re colonne)
            headerRow.innerHTML = '<th>Jeux / Joueurs</th>';
            tableBody.innerHTML = '';

            // Ajouter les en-t√™tes des joueurs
            players.forEach(player => {
                const th = document.createElement('th');
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = player;
                th.appendChild(nameSpan);
                
                const actionButtons = document.createElement('span');
                actionButtons.className = 'action-buttons';
                actionButtons.innerHTML = `
                    <button class="icon-btn edit" onclick="editPlayer('${player}', this.closest('th'))" title="√âditer">
                        ‚úèÔ∏è
                    </button>
                    <button class="icon-btn delete" onclick="deletePlayer('${player}')" title="Supprimer">
                        üóëÔ∏è
                    </button>
                `;
                th.appendChild(actionButtons);
                
                headerRow.appendChild(th);
            });

            // Ajouter les lignes de jeux
            games.forEach(game => {
                const tr = document.createElement('tr');
                
                // Premi√®re colonne : nom du jeu avec image
                const tdGame = document.createElement('td');
                
                const gameContainer = document.createElement('div');
                gameContainer.className = 'game-name-with-image';
                
                // Add game image
                const imageCache = gameImagesCache[game];
                if (imageCache && imageCache.imageUrl) {
                    const img = document.createElement('img');
                    img.src = imageCache.imageUrl;
                    img.alt = game;
                    img.className = 'game-image-small';
                    img.onerror = function() {
                        this.style.display = 'none';
                        const fallback = document.createElement('div');
                        fallback.className = 'game-image-fallback';
                        fallback.textContent = 'üéÆ';
                        this.parentElement.insertBefore(fallback, this);
                    };
                    gameContainer.appendChild(img);
                } else {
                    const fallback = document.createElement('div');
                    fallback.className = 'game-image-fallback';
                    fallback.textContent = 'üéÆ';
                    gameContainer.appendChild(fallback);
                }
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = game;
                gameContainer.appendChild(nameSpan);
                
                tdGame.appendChild(gameContainer);
                
                const actionButtons = document.createElement('span');
                actionButtons.className = 'action-buttons';
                actionButtons.innerHTML = `
                    <button class="icon-btn edit" onclick="editGame('${game}', this.closest('td'))" title="√âditer">
                        ‚úèÔ∏è
                    </button>
                    <button class="icon-btn delete" onclick="deleteGame('${game}')" title="Supprimer">
                        üóëÔ∏è
                    </button>
                `;
                tdGame.appendChild(actionButtons);
                
                tr.appendChild(tdGame);

                // Colonnes des joueurs avec cases √† cocher
                players.forEach(player => {
                    const td = document.createElement('td');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.dataset.game = game;
                    checkbox.dataset.player = player;
                    
                    const firebaseKey = toFirebaseKey(game);
                    const isChecked = checkedState[firebaseKey] && checkedState[firebaseKey][player];
                    checkbox.checked = isChecked;
                    
                    checkbox.addEventListener('change', (e) => {
                        handleCheckboxChange(game, player, e.target.checked);
                    });
                    
                    if (isChecked) {
                        td.classList.add('checked');
                    }
                    
                    td.appendChild(checkbox);
                    tr.appendChild(td);
                });

                tableBody.appendChild(tr);
            });
        }

        // G√©rer la touche Entr√©e
        document.getElementById('newGame').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addGame();
            }
        });

        document.getElementById('newPlayer').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });
        
        // Clip form enter key handling
        document.getElementById('clipTitle').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                uploadClip();
            }
        });
        
        document.getElementById('clipUrl').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                uploadClip();
            }
        });

        // Check Firebase configuration on load - AUTO-CONNECT
        function checkFirebaseConfig() {
            // Firebase est d√©j√† configur√©, connexion automatique!
            initializeFirebase(firebaseConfig);
        }



        // Initialize Firebase
        function initializeFirebase(config) {
            try {
                if (!firebase.apps.length) {
                    firebaseApp = firebase.initializeApp(config);
                } else {
                    firebaseApp = firebase.app();
                }

                database = firebase.database();
                isFirebaseConfigured = true;
                updateConnectionStatus(true);

                // Listen for real-time updates
                setupFirebaseListeners();

                // Load initial data or initialize
                loadDataFromFirebase();
            } catch (error) {
                console.error('Erreur Firebase:', error);
                updateConnectionStatus(false);
                alert('Erreur lors de l\'initialisation de Firebase. V√©rifiez votre configuration.');
            }
        }

        // Update connection status
        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            const indicator = statusEl.querySelector('.status-indicator');
            const text = statusEl.querySelector('.status-text');

            if (connected) {
                indicator.className = 'status-indicator connected';
                text.textContent = 'Connect√© √† Firebase ‚úì';
            } else {
                indicator.className = 'status-indicator disconnected';
                text.textContent = 'Non connect√© √† Firebase ‚úó';
            }
        }

        // Setup Firebase listeners for real-time updates
        function setupFirebaseListeners() {
            // Listen for players changes
            database.ref('players').on('value', (snapshot) => {
                if (isInitializing || !hasLoadedInitialData) return;
                const data = snapshot.val();
                if (data) {
                    players.length = 0;
                    players.push(...data);
                    renderTable();
                    updateStats();
                }
            });

            // Listen for games changes
            database.ref('games').on('value', (snapshot) => {
                if (isInitializing || !hasLoadedInitialData) return;
                const data = snapshot.val();
                if (data) {
                    games.length = 0;
                    games.push(...data);
                    renderTable();
                    updateStats();
                }
            });

            // Listen for checked state changes
            database.ref('checkedState').on('value', (snapshot) => {
                if (isInitializing || !hasLoadedInitialData) return;
                const data = snapshot.val();
                if (data) {
                    checkedState = data;
                    renderTable();
                }
            });
            
            // Listen for clips changes
            database.ref('clips').on('value', (snapshot) => {
                if (isInitializing || !hasLoadedInitialData) return;
                const data = snapshot.val();
                if (data) {
                    clips = Object.values(data);
                    if (activeTab === 'clips') {
                        renderClipsGallery();
                        renderFilterTags();
                    }
                }
            });
            
            // Listen for game images cache changes
            database.ref('gameImagesCache').on('value', (snapshot) => {
                if (isInitializing || !hasLoadedInitialData) return;
                const data = snapshot.val();
                if (data) {
                    gameImagesCache = data;
                    renderTable();
                    if (activeTab === 'random') {
                        initializeRandomWheel();
                    }
                    if (activeTab === 'clips') {
                        renderFilterTags();
                    }
                }
            });
            
            // Listen for wheel state changes (real-time sync)
            database.ref('wheelState').on('value', (snapshot) => {
                if (isInitializing || !hasLoadedInitialData) return;
                const data = snapshot.val();
                if (data && activeTab === 'random') {
                    handleWheelStateUpdate(data);
                }
            });
            
            // Listen for spin history changes
            database.ref('spinHistory').on('value', (snapshot) => {
                if (isInitializing || !hasLoadedInitialData) return;
                const data = snapshot.val();
                if (data) {
                    spinHistory = Object.values(data).sort((a, b) => b.timestamp - a.timestamp).slice(0, 10);
                    if (activeTab === 'random') {
                        renderSpinHistory();
                    }
                }
            });
        }

        // Load data from Firebase
        function loadDataFromFirebase() {
            isInitializing = true;
            
            database.ref('/').once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    
                    if (data && data.players && data.games) {
                        // Load existing data from Firebase
                        players.length = 0;
                        players.push(...data.players);
                        
                        // Load clips
                        if (data.clips) {
                            clips = Object.values(data.clips);
                        }
                        
                        games.length = 0;
                        games.push(...data.games);
                        
                        if (data.checkedState) {
                            // Ensure all games have Firebase keys in checkedState
                            checkedState = data.checkedState;
                            
                            // Migrate old data if needed (from / to _)
                            games.forEach(game => {
                                const firebaseKey = toFirebaseKey(game);
                                if (!checkedState[firebaseKey] && checkedState[game]) {
                                    // Migrate old key to new key
                                    checkedState[firebaseKey] = checkedState[game];
                                    delete checkedState[game];
                                } else if (!checkedState[firebaseKey]) {
                                    // Initialize if doesn't exist
                                    checkedState[firebaseKey] = {};
                                    players.forEach(player => {
                                        checkedState[firebaseKey][player] = false;
                                    });
                                }
                            });
                        } else {
                            initializeState();
                        }
                    } else {
                        // Initialize with default data
                        initializeState();
                        saveAllDataToFirebase();
                    }
                    
                    renderTable();
                    updateStats();
                    isInitializing = false;
                    hasLoadedInitialData = true;
                    
                    // Load game images cache
                    loadGameImagesCacheFromFirebase();
                })
                .catch((error) => {
                    console.error('Erreur lors du chargement:', error);
                    initializeState();
                    renderTable();
                    updateStats();
                    isInitializing = false;
                    hasLoadedInitialData = true;
                });
        }

        // Save all data to Firebase
        function saveAllDataToFirebase() {
            if (!isFirebaseConfigured) return;
            
            database.ref('/').set({
                players: players,
                games: games,
                checkedState: checkedState
            });
        }

        // Save players to Firebase
        function savePlayersToFirebase() {
            if (!isFirebaseConfigured) return;
            database.ref('players').set(players);
        }

        // Save games to Firebase
        function saveGamesToFirebase() {
            if (!isFirebaseConfigured) return;
            database.ref('games').set(games);
        }

        // Save checked state to Firebase
        function saveCheckedStateToFirebase() {
            if (!isFirebaseConfigured) return;
            database.ref('checkedState').set(checkedState);
        }
        
        // Save clips to Firebase
        function saveClipsToFirebase() {
            if (!isFirebaseConfigured) return;
            
            const clipsObject = {};
            clips.forEach(clip => {
                clipsObject[clip.id] = clip;
            });
            
            database.ref('clips').set(clipsObject);
        }
        
        // Save game images cache to Firebase
        function saveGameImagesCacheToFirebase() {
            if (!isFirebaseConfigured) return;
            database.ref('gameImagesCache').set(gameImagesCache);
        }
        
        // Load game images cache from Firebase
        function loadGameImagesCacheFromFirebase() {
            if (!isFirebaseConfigured) return;
            
            database.ref('gameImagesCache').once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        gameImagesCache = data;
                        renderTable();
                        if (activeTab === 'random') {
                            initializeRandomWheel();
                        }
                        if (activeTab === 'clips') {
                            renderFilterTags();
                        }
                    } else {
                        // No cache exists, fetch images for existing games
                        loadAllGameImages();
                    }
                })
                .catch((error) => {
                    console.error('Error loading game images cache:', error);
                });
        }

        // Random Wheel Functions
        
        function initializeRandomWheel() {
            wheelCanvas = document.getElementById('wheelCanvas');
            if (!wheelCanvas) return;
            
            wheelCtx = wheelCanvas.getContext('2d');
            
            // Populate game checkboxes with images
            const container = document.getElementById('randomGameCheckboxes');
            container.innerHTML = '';
            
            games.forEach((game, index) => {
                const item = document.createElement('div');
                item.className = 'game-checkbox-item';
                
                const imageCache = gameImagesCache[game];
                const imageHtml = imageCache && imageCache.imageUrl ? 
                    `<img src="${imageCache.imageUrl}" alt="${escapeHtml(game)}" class="wheel-game-item-image" onerror="this.style.display='none';" />` :
                    `<div class="wheel-game-item-image" style="display:flex;align-items:center;justify-content:center;font-size:16px;">üéÆ</div>`;
                
                item.innerHTML = `
                    <input type="checkbox" id="wheel-game-${index}" value="${escapeHtml(game)}" onchange="updateSelectedGames()">
                    ${imageHtml}
                    <label for="wheel-game-${index}" style="flex:1;cursor:pointer;">${escapeHtml(game)}</label>
                `;
                container.appendChild(item);
            });
            
            // Draw initial empty wheel
            drawWheel([]);
            updateSelectedGames();
            renderSpinHistory();
        }
        
        function updateSelectedGames() {
            const checkboxes = document.querySelectorAll('#randomGameCheckboxes input[type="checkbox"]');
            selectedGamesForWheel = [];
            
            checkboxes.forEach((checkbox, index) => {
                const item = checkbox.closest('.game-checkbox-item');
                if (checkbox.checked) {
                    selectedGamesForWheel.push(checkbox.value);
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
            
            // Update count
            document.getElementById('randomGameCount').textContent = 
                `${selectedGamesForWheel.length} jeu${selectedGamesForWheel.length !== 1 ? 'x' : ''} s√©lectionn√©${selectedGamesForWheel.length !== 1 ? 's' : ''}`;
            
            // Enable/disable spin button
            const spinButton = document.getElementById('spinButton');
            spinButton.disabled = selectedGamesForWheel.length === 0 || isSpinning;
            
            // Redraw wheel
            if (!isSpinning) {
                drawWheel(selectedGamesForWheel);
            }
        }
        
        function drawWheel(gamesList) {
            if (!wheelCtx) return;
            
            const canvas = wheelCanvas;
            const ctx = wheelCtx;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = canvas.width / 2 - 10;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (gamesList.length === 0) {
                // Draw empty wheel
                ctx.fillStyle = '#e0e0e0';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                ctx.fill();
                
                ctx.fillStyle = '#666';
                ctx.font = '20px var(--font-family-base)';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('S√©lectionnez des jeux', centerX, centerY);
                return;
            }
            
            const anglePerSection = (2 * Math.PI) / gamesList.length;
            
            // Draw sections
            gamesList.forEach((game, index) => {
                const startAngle = currentRotation + index * anglePerSection;
                const endAngle = startAngle + anglePerSection;
                
                // Draw section
                ctx.fillStyle = wheelColors[index % wheelColors.length];
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fill();
                
                // Draw border
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.stroke();
                
                // Draw text
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + anglePerSection / 2);
                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px var(--font-family-base)';
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                
                const text = game.length > 20 ? game.substring(0, 17) + '...' : game;
                ctx.fillText(text, radius * 0.5, 0);
                ctx.restore();
            });
            
            // Draw center circle
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 30, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.stroke();
        }
        
        function spinWheel() {
            if (isSpinning || selectedGamesForWheel.length === 0) return;
            
            isSpinning = true;
            document.getElementById('spinButton').disabled = true;
            document.getElementById('wheelResult').innerHTML = '';
            
            // Generate random result
            const randomIndex = Math.floor(Math.random() * selectedGamesForWheel.length);
            const winner = selectedGamesForWheel[randomIndex];
            
            // Calculate target rotation (multiple full spins + random position)
            const spins = 5 + Math.random() * 3; // 5-8 full rotations
            const anglePerSection = (2 * Math.PI) / selectedGamesForWheel.length;
            const targetAngle = spins * 2 * Math.PI + randomIndex * anglePerSection + anglePerSection / 2;
            
            const startTime = Date.now();
            const duration = 5000; // 5 seconds
            const startRotation = currentRotation;
            
            // Save to Firebase for real-time sync
            const wheelState = {
                isSpinning: true,
                selectedGames: selectedGamesForWheel,
                startRotation: startRotation,
                targetAngle: targetAngle,
                winner: winner,
                startTime: startTime,
                duration: duration
            };
            
            if (isFirebaseConfigured) {
                database.ref('wheelState').set(wheelState);
            }
            
            animateSpin(startTime, duration, startRotation, targetAngle, winner);
        }
        
        function animateSpin(startTime, duration, startRotation, targetAngle, winner) {
            const now = Date.now();
            const elapsed = now - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // Easing function (ease-out cubic)
            const easeProgress = 1 - Math.pow(1 - progress, 3);
            
            currentRotation = startRotation + targetAngle * easeProgress;
            drawWheel(selectedGamesForWheel);
            
            if (progress < 1) {
                requestAnimationFrame(() => animateSpin(startTime, duration, startRotation, targetAngle, winner));
            } else {
                // Spin complete
                isSpinning = false;
                document.getElementById('spinButton').disabled = false;
                showResult(winner);
                addToHistory(winner);
                
                if (isFirebaseConfigured) {
                    database.ref('wheelState/isSpinning').set(false);
                }
            }
        }
        
        function showResult(winner) {
            const resultEl = document.getElementById('wheelResult');
            resultEl.innerHTML = `<div class="result-display">üéâ ${escapeHtml(winner)} a √©t√© choisi!</div>`;
            
            // Create confetti effect
            createConfetti();
        }
        
        function createConfetti() {
            const wheelSection = document.querySelector('.wheel-section');
            const colors = ['#1FB8CD', '#FFC185', '#B4413C', '#D2BA4C', '#DB4545'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
                    wheelSection.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 30);
            }
        }
        
        function addToHistory(winner) {
            const historyItem = {
                id: Date.now().toString(),
                game: winner,
                timestamp: Date.now()
            };
            
            spinHistory.unshift(historyItem);
            spinHistory = spinHistory.slice(0, 10); // Keep only last 10
            
            if (isFirebaseConfigured) {
                const historyObject = {};
                spinHistory.forEach(item => {
                    historyObject[item.id] = item;
                });
                database.ref('spinHistory').set(historyObject);
            }
            
            renderSpinHistory();
        }
        
        function renderSpinHistory() {
            const container = document.getElementById('spinHistory');
            
            if (spinHistory.length === 0) {
                container.innerHTML = '<div class="empty-state-text" style="color: var(--color-text-secondary); font-size: var(--font-size-sm);">Aucun r√©sultat pour le moment</div>';
                return;
            }
            
            container.innerHTML = spinHistory.map(item => {
                const date = new Date(item.timestamp);
                const timeStr = date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                const dateStr = date.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit' });
                
                return `
                    <div class="history-item">
                        <div class="history-item-game">${escapeHtml(item.game)}</div>
                        <div class="history-item-time">${dateStr} √† ${timeStr}</div>
                    </div>
                `;
            }).join('');
        }
        
        function handleWheelStateUpdate(state) {
            if (!state.isSpinning || isSpinning) return;
            
            // Sync the wheel spin from another user
            selectedGamesForWheel = state.selectedGames;
            isSpinning = true;
            document.getElementById('spinButton').disabled = true;
            document.getElementById('wheelResult').innerHTML = '';
            
            // Update checkboxes
            const checkboxes = document.querySelectorAll('#randomGameCheckboxes input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectedGamesForWheel.includes(checkbox.value);
                const item = checkbox.closest('.game-checkbox-item');
                if (checkbox.checked) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
            
            updateSelectedGames();
            
            // Calculate remaining animation time
            const now = Date.now();
            const elapsed = now - state.startTime;
            const remaining = state.duration - elapsed;
            
            if (remaining > 0) {
                animateSpin(state.startTime, state.duration, state.startRotation, state.targetAngle, state.winner);
            } else {
                // Spin already finished
                currentRotation = state.startRotation + state.targetAngle;
                drawWheel(selectedGamesForWheel);
                isSpinning = false;
                document.getElementById('spinButton').disabled = false;
                showResult(state.winner);
            }
        }
        
        // Initialiser l'application
        initializeState();
        renderTable();
        updateStats();
        checkFirebaseConfig();
    </script>
</body>
</html>